{% extends "graphgamel/index.html" %}

{% load i18n %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url graph.views.index %}">Home</a>&rsaquo;
    <a href="{% url graph.views.editor graph_id%}">Editor</a>&rsaquo;
    <a href="{% url graph.views.node_info graph_id node_id %}">Node Info</a>
</div>
{% endblock %}

{% block extracode %}
<script type="application/javascript">

    var SCHEMA_DATA = {outgoing: {{ outgoing|safe }},
                        incoming: {{ incoming|safe }}}


    window.onload = function() {
        GRAPHGAMEL.populate_table('properties_table', {{ properties|safe }});
        GRAPHGAMEL.populate_select(document.getElementById('out_relation'),
                        SCHEMA_DATA.outgoing);
        if (document.getElementById('out_relation').value != "") {
            GRAPHGAMEL.populate_select(document.getElementById('out_node_type'),
                        SCHEMA_DATA.outgoing[document.getElementById('out_relation').value]);
        }
        GRAPHGAMEL.populate_select(document.getElementById('in_relation'),
                        SCHEMA_DATA.incoming);
        if (document.getElementById('in_relation').value != "") {
            GRAPHGAMEL.populate_select(document.getElementById('in_node_type'),
                        SCHEMA_DATA.incoming[document.getElementById('in_relation').value]);
        }
    }
</script>
{% endblock %}

{% block content %}
<div id="main">
<h1>Node info</h1>
<h3>Actions</h3>
<a class="deletelink" onclick="GRAPHGAMEL.delete_node()">Delete this node</a>
<h3>Properties</h3>
<table id="properties_table" class="properties"></table>
<h5>Add property</h5>
    <input type="text" id="new_property_key">
    <input type="text" id="new_property_value">
    <input type="button" value="Add new property" onClick="GRAPHGAMEL.add_property()">
<h3>Relationships</h3>
<table>
{% for relation in relationships %}
    <tr>
        <td><a href="{% url graph.views.node_info graph_id relation.start_neo_id %}">{{ relation.start_id }}</a>
            ({{ relation.start_type }})</td>
        <td>{{ relation.relation_type }}</td>
        <td><a href="{% url graph.views.node_info graph_id relation.end_neo_id %}">{{ relation.end_id }}</a>
            ({{ relation.end_type }})</td>
        <td><a href="{% url graph.views.relation_info graph_id relation.start_neo_id relation.relation_type relation.end_neo_id %}">Open relation</a></td>
    <tr>
{% endfor %}
</table>
<h5>Add outgoing relationship</h5>
<select id="out_relation" name="out_relation" onblur="GRAPHGAMEL.populate_select(document.getElementById('out_node_type'), SCHEMA_DATA['outgoing'][document.getElementById('out_relation').value])"></select>
<select id="out_node_type" name="out_node_type"></select>
<input id="out_node_id" name="out_node_id">
<input type="button" value="Search node" onclick="GRAPHGAMEL.search_node('out_node');">
<h5>Add incoming relationship</h5>
<select id="in_relation" name="in_relation" onblur="GRAPHGAMEL.populate_select(document.getElementById('in_node_type'), SCHEMA_DATA['incoming'][document.getElementById('in_relation').value])"></select>
<select id="in_node_type" name="in_node_type"></select>
<input id="in_node_id" name="in_node_id">
<input type="button" value="Search node" onclick="GRAPHGAMEL.search_node('out_node');">
</div>
<div id="right_tab">

</div>
{% endblock %}
